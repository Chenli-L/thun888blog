---
title: 主题改动小记
date: 2024-04-19 21:05:29
updated: 2024-04-20 08:05:29
tags: Blog
cover:
description: 记录下更改
banner:
categories: 瞎折腾
references:
 - '[Hexo Stellar 主题装修笔记-宇宙尽头的餐馆(flyalready.cn)](https://flyalready.cn/Hexo%20Stellar%20主题装修笔记/#超链接样式调整)'
---

很久之前，为了在主题中新增功能还是改主题文件实现的，不过因为没有用Git进行管理，后面带来一个很严重的问题：{% mark 升级十分困难 color:blue %}。

当然，即便早已摆脱了那种想升级又不敢升级的困境，我还是不喜欢对主题进行过多的侵入式修改，在前几个月我陆陆续续将主题中一些自定义的部分阉掉或通过外部注入实现，但随之而来又有一个问题：{% mark 可自定义程度低 color:blue %}。

罢了罢了，我自己写一篇文章来记录改动吧。{% emoji blobcat blobcatnotlikethis %}

{% note color:red 叠甲 本文仅用作记录，不具备任何教程性质，仅供参考 %}

## 非直接修改主题

### 烟花特效&运行时间&复制提醒&超链接图标

<script src="https://hightlight-code-api.hzchu.top/api/v1/generate?url=https://raw.githubusercontent.com/thun888/myblog/main/source/js/extra.js&lang=js"></script>

`烟花特效&运行时间`来自网络

### 加载动画

通过`injector`实现

<script src="https://hightlight-code-api.hzchu.top/api/v1/generate?url=https://raw.githubusercontent.com/thun888/myblog/main/scripts/headend.js&lang=js"></script>

对应的js

<script src="https://hightlight-code-api.hzchu.top/api/v1/generate?url=https://raw.githubusercontent.com/thun888/myblog/main/source/js/load.js&lang=js"></script>

### 哔哔广场

与其说是广场，~~不如说是个人独秀~~（毕竟我这也不是正经的Memos

魔改自[哔哔广场-木木木木木 (immmmm.com)](https://immmmm.com/bbs/)

```markdown source\bb\index.md
---
title: 哔哔
date: 2021-07-10 19:06:52
description: 闲来无事，哔哔两句
layout: post
comments: false
---

<div id="memos" style="display: none;"></div>
<div id="memo-list"></div>
<link rel="stylesheet" href="https://cdn.staticfile.org/aplayer/1.10.1/APlayer.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/animate.css/4.1.1/animate.min.css">
<link rel="stylesheet" href="https://memobbs.app/grid.css">
<link rel="stylesheet" href="https://memobbs.app/memos.css">
<script src="https://cdn.staticfile.org/marked/7.0.5/marked.min.js"></script>
<script src="https://cdn.staticfile.org/aplayer/1.10.1/APlayer.min.js"></script>
<script>
var meting_api='https://api.injahow.cn/meting/?server=:server&type=:type&id=:id&auth=:auth&r=:r';
</script>
<script src="https://cdn.staticfile.org/meting/2.0.1/Meting.min.js"></script>
<script src="https://cdn.staticfile.org/lozad.js/1.16.0/lozad.min.js"></script>
<script src="/js/memos.js"></script>

<script type="text/javascript">
  var memosMyList = [
    {
      "creatorName" : "Thun888",
      "website" : "https://blog.hzchu.top",
      "link" : "https://get-tg-channel-api.hzchu.top",
      "creatorId" : "101",
      "avatar" : "/img/avatar.webp",
      "artalk" : "https://artalk.hzchu.top",
      "artSite" : "Blog"
    }
  ]
</script>
```

对应的js

<script src="https://hightlight-code-api.hzchu.top/api/v1/generate?url=https://raw.githubusercontent.com/thun888/myblog/main/source/js/memos.js&lang=js"></script>

## 直接修改主题

### 字数统计

```js themes\stellar\layout\_partial\main\footer.ejs
...
// footer
  el += '<div class="text">'
    if (content) {
      el += markdown(content)
    }
    el += '<script> var allpostscount = "' + site.posts.length + '" ;var allpostswords = "' + totalcount(site) + '";gtime_days = Math.floor((new Date() - new Date(' + page.updated + ')) / 1000 / 60 / 60 / 24);</script>'
    el += '</div></footer>'
    return el
  }
  %>
  <%- layoutDiv() %>
```

将字数信息引入到变量中供调用

```html
<span id="timeDate">载入天数...</span><span>&</span><span id="times">载入时分秒...</span>，共发表了<span id="all-posts-count">load</span>篇文章，总计<span id="all-post-words">load</span>字
```

相关js参阅[#烟花特效-运行时间-复制提醒-超链接图标](#烟花特效-运行时间-复制提醒-超链接图标)

**文章内字数统计**

```js themes\stellar\layout\_partial\main\navbar\article_banner.ejs
...
  // 3.left.bottom
  el += partial('dateinfo')
  //字数显示
  el += '<div class="flex-row" id="page-words"><span>&nbsp;本文字数：' + page.content.length + '字</span></div>';
```

### 文章内过期提醒

变量获取一并放在`footer`里了

```js themes\stellar\layout\page.ejs
...
  el += `<article class="${articleClass()}">`
  //过期提醒容器
  el +=`<div id="gtime"></div>`
```

相关js参阅[#烟花特效-运行时间-复制提醒-超链接图标](#烟花特效-运行时间-复制提醒-超链接图标)

### 文章内标签显示

紧跟在`文章内字数统计`下方

```js themes\stellar\layout\_partial\main\navbar\article_banner.ejs
  //标签显示
  if (page.layout == "post" && page.tags && page.tags.length > 0) {
    el += '<div class="flex-row" id="tag">'; // 将标签容器的创建移动到条件内部
    el += ' <span>&nbsp标签：</span>';
    el += list_categories(page.tags, {
      class: "cap breadcrumb",
      show_count: false,
      separator: '&nbsp; ',
      style: "none"
    });
    el += '&nbsp</div>';
  }
```

### 显示Artalk最近评论

```js themes\stellar\source\js\services\artalk.js
utils.jq(() => {
    $(function () {
      const els = document.getElementsByClassName('ds-artalk');
      for (var i = 0; i < els.length; i++) {
        const el = els[i];
        const limit = parseInt(el.getAttribute('limit')) || 10;
  
        const api = el.getAttribute('api') + '&limit=' + limit;
        if (api == null) {
          continue;
        }
        utils.request(el, api, function (data) {
          data = data.data || [];
          data.forEach((item, i) => {
            var cell = '<div class="timenode" index="' + i + '">';
            cell += '<div class="header">';
            cell += '<div class="user-info">';
            // cell += '<img src="https://cravatar.cn/avatar/' + (item.email_encrypted) + '?d=mp&s=240">';
            cell += '<span>' + item.nick + '</span>';
            cell += '</div>';
            cell += '<span>' + new Date(item.date).toLocaleString() + '</span>';
            cell += '</div>';
            cell += '<a class="body" href="' + item.page_url + '#atk-comment-' + item.id + '" target="_blank" rel="external nofollow noopener noreferrer">';
            cell += item.content_marked;
            cell += '</a>';
            cell += '</div>';
            $(el).append(cell);
          });
        });
      }
    });
  });
```

组件引入：

```yaml source\_data\widgets.yml
new_comment:
  layout: timeline
  title: 最新评论
  api: https://artalk.hzchu.top/api/v2/stats/latest_comments?site_name=Thun888 # 此处为 Artalk API 地址，末尾为站点名称
  type: artalk
  limit: 10 # 限制获取数量，默认为 10
```

### 部分用语改动

```yaml themes\stellar\languages\zh-CN.yml
meta:
  related_posts: 这些怎么样（￣︶￣）↗　
```

